logging:
  level: INFO

training:
  epochs: 1
  batch_size: 32
  gradient_accumulation: 4
  mixed_precision: bf16
  grad_clip_norm: 1.0
  log_interval: 2
  max_steps: 12  # Very short run for quick profiling
  output_dir: artifacts/profile_overlap_2gpu
  inject_allreduce_copies: true  # Enable stress pattern to reproduce inefficiency
  allreduce_stress_level: 3      # Moderate stress level

optimizer:
  lr: 0.0002
  weight_decay: 0.01
  betas: [0.9, 0.985]

scheduler:
  warmup_steps: 5
  total_steps: 12

dataset:
  num_samples: 2000
  sequence_length: 128
  dense_dim: 256
  sparse_features: 64
  vocab_size: 200000
  num_dense_features: 24
  seed: 1234

model:
  vocab_size: 200000
  embedding_dim: 256
  num_dense_features: 24
  dense_dim: 256
  model_dim: 1024
  num_heads: 16
  num_layers: 12
  dropout: 0.1
  mlp_hidden_dim: 4096

fsdp:
  sharding_strategy: full_shard
  backward_prefetch: BACKWARD_PRE
  use_orig_params: true
  limit_all_gathers: false
  forward_prefetch: true
  sync_module_states: true
  param_init_device: meta

compile:
  enabled: false

dataloader:
  num_workers: 2
  pin_memory: true

profiling:
  enabled: true
  wait: 1         # Wait 1 step
  warmup: 2       # Warmup 2 steps
  active: 4       # Profile 4 steps
  repeat: 1
  record_shapes: false  # Minimal to avoid crash
  profile_memory: false
  with_stack: false
  with_flops: false
  tensorboard: true
  chrome_trace: false  # Disabled - causes crash on ROCm
  trace_filename: trace.json
